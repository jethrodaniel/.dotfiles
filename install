#!/usr/bin/env bash

this_dir=$(dirname $(readlink -f $0))
source "${this_dir}/helpers.sh"

# From <https://docs.brew.sh/Homebrew-on-Linux>
  test -d /home/linuxbrew/.linuxbrew && eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)
setup_homebrew() {
  sudo apt-get install build-essential curl file git gcc

  git clone https://github.com/Homebrew/brew ~/.linuxbrew/Homebrew
  mkdir ~/.linuxbrew/bin
  ln -fs ~/.linuxbrew/Homebrew/bin/brew ~/.linuxbrew/bin
  eval $(~/.linuxbrew/bin/brew shellenv)

  brew install core
}

install_dotfiles() {
  sudo apt-get update

  setup_homebrew

  brew install --display-times \
    homeshick \
    tree \
    vim \
    hub \
    xclip \
    ruby-build

  yes | homeshick clone jethrodaniel/dotfiles

  sudo apt-get install -y \
    x11-xkb-utils \
    i3 \
    pavucontrol \
    ttf-ancient-fonts \
    feh

  # Symlink tmux settings into the home dir
  ln -s ~/.tmux/conf ~/.tmux.conf

  say <<-MSG
		Done. Be sure to run

			\`prefix+I\` inside tmux, then reopen tmux.
	MSG
}

main() {
   say <<-MSG
		Setting up dotfiles...

		This is probably going to take a while. Time for â˜•.
	MSG

  confirmation=<<-MSG
		Sure you want to install? It's gonna be like an hour or more.

		And will currently just try to overwrite everything. ðŸ’£
	MSG

  if ask "$confirmation"; then
    echo 'Installing the dotfiles...'
    install_dotfiles
  else
    echo 'Exiting...'
  fi
}
main

