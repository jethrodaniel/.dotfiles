#!/usr/bin/env bash

this_dir=$(dirname $(readlink -f $0))
source "${this_dir}/helpers.sh"

say "Setting up dotfiles..."

set -x

#------------------------------------------------------------
# Prerequisite software
#------------------------------------------------------------
sudo apt-get update

sudo apt-get install -y vim \
                        vim-gnome \
                        git \
                        tree \
                        tmux \
                        xclip \
                        trash-cli \
                        x11-xkb-utils

sudo apt-get -y upgrade \
  && sudo apt-get -y autoremove

#------------------------------------------------------------
# Homeshick
#------------------------------------------------------------
git clone https://github.com/andsens/homeshick.git \
          $HOME/.homesick/repos/homeshick
source "$HOME/.homesick/repos/homeshick/homeshick.sh"

set +x
if ask 'Clone with ssh?'; then
  set -x
  yes | homeshick clone git@github.com:jethrodaniel/dotfiles
else
  set -x
  yes | homeshick clone jethrodaniel/dotfiles
fi

set +x
if ask 'Is this a work setup?'; then
  echo 'remember to set `user.{email,signingkey}` in ~/gitconfig_work'
  set -x
else
  set -x
fi

#------------------------------------------------------------
# Rbenv plugins and Ruby
#------------------------------------------------------------
git clone https://github.com/rbenv/ruby-build.git \
          ~/.rbenv/plugins/ruby-build

set +x
if ask 'Install Ruby 2.5.3?'; then
  set -x
  rbenv install 2.5.3
  rbenv global 2.5.3
else
  set -x
fi

#------------------------------------------------------------
# Get public GPG keys from Github
#------------------------------------------------------------
~/.homesick/repos/dotfiles/gpg.rb

set +x

say "Done. Be sure to run"
say "\t${reset}source ~/.bashrc"
say "and"
say "\t${reset}run 'ctrl+f+I' inside tmux"
say "to get started."
